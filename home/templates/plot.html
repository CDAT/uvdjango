<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
<link rel="stylesheet" href="{{STATIC_URL}}css/plot.css" type="text/css" />
  <script type="text/javascript" src="https://www.google.com/jsapi"> </script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  
  <script type="text/javascript"
      src="http://maps.google.com/maps/api/js?sensor=false&libraries=drawing"></script>
      
  <script type="text/javascript">
      var drawingManager;
      var selectedShape;
      var colors = ['#1E90FF', '#FF1493', '#32CD32', '#FF8C00', '#4B0082'];
      var selectedColor;
      var colorButtons = {};

      function clearSelection() {
        if (selectedShape) {
          selectedShape.setEditable(false);
          selectedShape = null;
        }
      }

      function setSelection(shape) {
        clearSelection();
        selectedShape = shape;
        shape.setEditable(true);
        selectColor(shape.get('fillColor') || shape.get('strokeColor'));
      }

      function deleteSelectedShape() {
        if (selectedShape) {
          selectedShape.setMap(null);
          drawingManager.setOptions({
       	   	drawingControl: true
       	  });
        }
      }

      function selectColor(color) {
        selectedColor = color;
        for (var i = 0; i < colors.length; ++i) {
          var currColor = colors[i];
          colorButtons[currColor].style.border = currColor == color ? '2px solid #789' : '2px solid #fff';
        }

        // Retrieves the current options from the drawing manager and replaces the
        // stroke or fill color as appropriate.
        var polylineOptions = drawingManager.get('polylineOptions');
        polylineOptions.strokeColor = color;
        drawingManager.set('polylineOptions', polylineOptions);

        var rectangleOptions = drawingManager.get('rectangleOptions');
        rectangleOptions.fillColor = color;
        drawingManager.set('rectangleOptions', rectangleOptions);

        var circleOptions = drawingManager.get('circleOptions');
        circleOptions.fillColor = color;
        drawingManager.set('circleOptions', circleOptions);

        var polygonOptions = drawingManager.get('polygonOptions');
        polygonOptions.fillColor = color;
        drawingManager.set('polygonOptions', polygonOptions);
      }

      function setSelectedShapeColor(color) {
        if (selectedShape) {
          if (selectedShape.type == google.maps.drawing.OverlayType.POLYLINE) {
            selectedShape.set('strokeColor', color);
          } else {
            selectedShape.set('fillColor', color);
          }
        }
      }

      function makeColorButton(color) {
        var button = document.createElement('span');
        button.className = 'color-button';
        button.style.backgroundColor = color;
        google.maps.event.addDomListener(button, 'click', function() {
          selectColor(color);
          setSelectedShapeColor(color);
        });

        return button;
      }

       function buildColorPalette() {
         var colorPalette = document.getElementById('color-palette');
         for (var i = 0; i < colors.length; ++i) {
           var currColor = colors[i];
           var colorButton = makeColorButton(currColor);
           colorPalette.appendChild(colorButton);
           colorButtons[currColor] = colorButton;
         }
         selectColor(colors[0]);
       }

      function initialize() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 1,
          center: new google.maps.LatLng(-25, 45),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          disableDefaultUI: true,
          zoomControl: true
        });

        var polyOptions = {
          strokeWeight: 0,
          fillOpacity: 0.45,
          editable: true
        };
        // Creates a drawing manager attached to the map that allows the user to draw
        // markers, lines, and shapes.
        drawingManager = new google.maps.drawing.DrawingManager({
        	drawingControl: true,
    	    drawingControlOptions: {
    	      position: google.maps.ControlPosition.TOP_LEFT,
    	      drawingModes: [
    	        google.maps.drawing.OverlayType.RECTANGLE
    	      ]
    	    },
          	rectangleOptions: {
  	        	fillColor: '#0000FF',
  	        	fillOpacity: 0.3,
  	        	strokeWeight: 5,
  	        	clickable: false,
  	        	draggable:true,
  	        	zIndex: 1,
  	        	editable: true
  	      	},
          	map: map
        });

        google.maps.event.addListener(drawingManager, 'overlaycomplete', function(e) {
            if (e.type != google.maps.drawing.OverlayType.MARKER) {
            // Switch back to non-drawing mode after drawing a shape.
            drawingManager.setDrawingMode(null);
            drawingManager.setOptions({
                drawingControl: false
              });
            var bounds=e.overlay.getBounds();
			var ne = bounds.getNorthEast();
			var sw = bounds.getSouthWest();
			north=ne.lat();
			south=sw.lat();
			east=ne.lng();
			west=sw.lng();
			window.alert("Coor: " + north + " " + south + " " + east + " " + west);
            // Add an event listener that selects the newly-drawn shape when the user
            // mouses down on it.
            var newShape = e.overlay;
            newShape.type = e.type;
            google.maps.event.addListener(newShape, 'click', function() {
              setSelection(newShape);
            });
            setSelection(newShape);
          }
        });

        // Clear the current selection when the drawing mode is changed, or when the
        // map is clicked.
        google.maps.event.addListener(drawingManager, 'drawingmode_changed', clearSelection);
        google.maps.event.addListener(map, 'click', clearSelection);
        google.maps.event.addDomListener(document.getElementById('delete-button'), 'click', deleteSelectedShape);

        buildColorPalette();
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  
  <script type="text/javascript">
  function toggle(tag_id)
  {
   a=document.getElementById('dataset_a'+tag_id);
   ul=document.getElementById('dataset_ul'+tag_id);
   if (ul.style.display=='block')
   {
    ul.style.display='none';
    a.innerHTML='+';
   }
  else
  {
    ul.style.display='block';
    a.innerHTML='-';
   }
  }
  </script>
  <script type="text/javascript">
function allowDrop(ev)
{
ev.preventDefault();
}

function drag(ev)
{
ev.dataTransfer.setData("Text",ev.target.id);
ev.dataTransfer.effectAllowed("copy");
}

function drop(ev)
{
ev.preventDefault();
var data=ev.dataTransfer.getData("Text");
ev.target.appendChild(document.getElementById(data).cloneNode(true));

}

</script>
<script> 
$(document).ready(function(){
	
	$("#flip2").click(function(){
	    $("#dataset_div").slideToggle("slow");
	  });
  $("#flip").click(function(){
    $("#panel").slideToggle("slow");
  });
  $("#flip1").click(function(){
	    $("#map3d").slideToggle("slow");
	    $("#coord_div").slideToggle("slow");
	  });
   $("#total_plot").change(function() {
	  var select_tag = $("#total_plot option:selected");
      var selected_val=select_tag.val();
      if (selected_val == '1')
      {
          if ($("#plot_row2").length != 0)
          {
              $("#plot_row2").remove();
          }
          if ($("#plot_1_2").length != 0)
          {
              $("#plot_1_2").remove();
          }
      }
      else if (selected_val == '2')
      {
    	  if ($("#plot_row2").length != 0)
          {
              $("#plot_row2").remove();
          }
    	  if ($("#plot_1_2").length == 0)
          {
    		  $("#plot_1_1").after("<td id=plot_1_2>Plot2</td>");
          }
      }
      else if (selected_val == '4')
      {
    	  if ($('#plot_1_2').length == 0)
          {
    		  $("#plot_1_1").after("<td id=plot_1_2>Plot2</td>");
          }
    	  if ($('#plot_row2').length == 0)
          {
    		  $("#plot_row1").after("<tr id=plot_row2><td id=plot_2_1>Plot3</td><td id=plot_2_2>Plot4</td></tr>");
    		  
          }
    	  
      }
   })
});
</script>
</head>
<body>
<div id=top_banner><h1>UV-CDAT Live</h1><hr></div>
<div id=top_link><a href="/logout/">Logout</a></div>
<div id=content>
<table>
<tr><td>
  <div id="flip">Plot Options</div>
  <div id="panel">
  <label id=input_label>Number of Plots</label>
  <select id=total_plot>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="4" selected>4</option>
  </select>
  <label id=input_label>Plot Type</label>
  <select>
  <option value="boxfill">Boxfill</option>
  </select>
  </div>
  <div id="flip1">Select Coordinates </div>
  <div id="coord_div">

  <label id="input_label">N:</label>
  <input id="n_text_input" type="text" value="-90">
  <label id="input_label">S:</label>
  <input id="s_text_input" type="text" value="90">
  <label id="input_label">E:</label>
  <input id="e_text_input" type="text" value="0">
  <label id="input_label">W:</label>
  <input id="w_text_input" type="text" value="180">
  <button id="delete-button">Reset</button>
  </div>
  <div id="map"  style="height: 350px; width: 335px;"></div>
  <!--  <div id="map3d" style="height: 350px; width: 335px;"></div>-->
  <div id=flip2>Dataset
  </div>
  <div id=dataset_div>
  <p id=dataset_p> 
  http://1thisisaveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryverylongurl
  <a id=dataset_a1 href="javascript:toggle('1');">+</a></p>
  <ul id=dataset_ul1 style="display:none">
  <li id="var1" draggable="true" ondragstart="drag(event)">var1</li>
  <li>var2</li>
  <li>var3</li>
  <li>var4</li>
  </ul>
  <p id=dataset_p>
  http://1thisisaveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryveryverylongurl
  <a id=dataset_a2 href="javascript:toggle('2');">+</a> </p>
  <ul id=dataset_ul2 style="display:none">
  <li>var1</li>
  <li>var2</li>
  <li>var3</li>
  <li>var4</li>
  </ul>
  </div>
  </td>
  <td>
  <table id=plot_panel>
  <tr id=plot_row1>
  <td id=plot_1_1 ondrop="drop(event)" ondragover="allowDrop(event)">Plot1</td>
  <td id=plot_1_2>Plot2</td>
  </tr>
  <tr id=plot_row2>
  <td id=plot_2_1>Plot3</td>
  <td id=plot_2_2>Plot4</td>
  </tr>
  </table>
  </td>
  </tr>
  </table>
  </div>
  <div id=footer><hr><a href="">Contact us</a></div>
</body>
</html>
